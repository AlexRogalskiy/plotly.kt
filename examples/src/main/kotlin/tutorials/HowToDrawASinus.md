### How To Draw A Sinus?
В задачах визуализации данных достаточно часто возникает необходимость
изображать математические функции - например, чтобы сравнить скорость сходимость модели
с идеальной или найти аппроксимацию для заданного времянного ряда. У таких
графиков есть ряд особенностей, не присущих большинству остальных графиков: например,
изображение перпендикулярных осей OX и OY из нуля и достаточно большое количество
дополнительной информации. Это может быть ожидаемое значение функции, точки её 
экстремумов, отклонение в различных точках и т.д.

В данном материале будет рассказано, как с помощью средств библиотеки `Plotly.kt` 
изобразить обыкновенный синус так, чтобы в итоге получился наглядный и информативный
график.


1. Начнем с того, что изобразим перпендикулярные оси OX и OY. Для этого необходимо
сделать несколько вещей: скрыть линии осей по умолчанию, скрыть линию нуля (т.к. на её конце
нельзя нарисовать стрелку) и добавить перпендикулярные стрелки с помощью аннотаций (`Text`) 
без текста, но с видимыми стрелочками. После этого подпишем сами оси. Также важно с самого начала 
указывать нужные размеры графика (`width`, `height`) для того, чтобы после сохранения
график выглядел так же, как и в браузере.
        
    ```
    Plotly.page {                                // создание новой html-страницы с графиком
        layout {
            width = 900                          // ширина графика в пикселях
            height = 500                         // высота графика в пикселях

            text {                               // вертикальная ось
                x = Value.of(0)                  // положение верхнего края стрелки = (0, 1+eps)
                y = Value.of(1 + eps)
                ax = Value.of(0)                 // ax, ay означает смещение нижнего края относительно верхнего
                ay = Value.of(430)               // положительное (отрицательное) значение - это длина стрелки
                                                 // снизу вверх (сверху вниз) и справа налево (слева направо)
            }

            text {                               // горизонтальная ось
                y = Value.of(0)                  // положение правого края стрелки = (2PI + eps, 0)
                x = Value.of(2 * PI + eps)
                ax = Value.of(-800)              // положение левого края стрелки 
                ay = Value.of(0)
            }

            xaxis {                              // параметры OX
                showline = false                 // скрыть линию OX
                zeroline = false                 // скрыть линию нуля
            }
            yaxis {                              // параметры OY
                showline = false                 // скрыть линию OY
                zeroline = false                 // скрыть линию нуля
            }
        }
    }.makeFile()                                 // создание временного файла и отображение в браузере графика
    ```
         
2. Теперь нарисуем саму функцию синуса - для её изображения выберем ярко-голубой цвет,
контрастирующий и с белым фоном, и с черными метками на осях. Также с помощью вариьрования
параметра `mode` (`ScatterMode: lines, markers`) точки пересечения с осью OY отметим
чуть более темным оттенком того же цвета.

    ```
    x1 = (-410..410).map{ it / 200 * PI }        // области определения функции (-2PI - eps, 2PI + eps)
    y1 = sin(x1)                                 // значения функции - синус

    Plotly.page {
        scatter {                                // создание графика типа Scatter - синус
            x.set(x1)                            // задание значений линии по OX
            y.set(y1)                            // задание значений линии по OY
            line { color(XKCD.CERULEAN) }        // цвет линии - лазурный
        }

        scatter {                                // создание графика типа Scatter - точки на OX
            mode = ScatterMode.markers           // отображение только точек
            x(-2* PI, -PI, PI, 2* PI)            // точки пересечения синуса с OX - значения по оси X
            y(0, 0, 0, 0)                        // точки пересечения синуса с OX - значения по оси Y
            line { color(XKCD.CERULEAN_BLUE) }   // цвет точек - более темный лазурный
            marker { size = 8 }                  // диаметр точки - 8 пикселей
        }

        layout { ... }
    }.makeFile()
    ```
3. Для большей наглядности нанесем на график горизонтальные пунктирные линии,
соответствующие значениям, равным -1, 1/2 и 1. Для этого нужно указать параметр `line.dash -> dash`.
Указанные значения в дальнейшем будут нанесены на ось OY с помощью параметров `tickvals` и `ticklabels`.

    ```
    ...
    Plotly.page {
        ...
        layout {
            shape {                               // добавление новой фигуры - линии y = 1
                x0 = Value.of(-2*PI)              // прямой линией будут соединены 
                x1 = Value.of(2*PI)               // координаты (-2PI, 1) и (2PI, 1)
                y0 = Value.of(1)
                y1 = Value.of(1)
                line { dash = Dash.dash }         // вид линии - пунктирный
            }

            shape {                               // добавление новой фигуры - линии y = 1/2
                x0 = Value.of(-2*PI)              // прямой линией будут соединены 
                x1 = Value.of(2*PI)               // координаты (-2PI, 1/2) и (2PI, 1/2)
                y0 = Value.of(0.5)
                y1 = Value.of(0.5)
                line {
                    color("red")                  // цвет линии - красный
                    dash = Dash.dash              // вид линии - пунктирный
                }
            }

            shape {                               // добавление новой фигуры - линии y = -1
                x0 = Value.of(-2*PI)              // прямой линией будут соединены 
                x1 = Value.of(2*PI)               // координаты (-2PI, -1) и (2PI, -1)
                y0 = Value.of(-1)
                y1 = Value.of(-1)
                line { dash = Dash.dash }         // вид линии - пунктирный
            }
            ...
        }
    }.makeFile()
    ```

4. После этого стоит добавить вертикальные линии, соединияющие точки на OX, значение
в которых равно 1/2, и само значение в формате LaTeX. Для этого снова используются фигуры - массив 
значений типа `Shape.line`. Для использования формата LaTeX необходимо подключить заголовок `MathJax`.
    ```
    ...
    val sub = PI / 6
    val xElems = listOf(-2PI + sub, -PI - sub, 0 + sub, PI - sub)
    // точки, в которых значение синуса равно 1/2

    val shapesList = mutableListOf<Shape>()        // создание списка нужных линий
    for (x: xElems) {
        val shape = Shape {
            x0 = Value.of(x)                       // будут соединены координаты (x, 0) и (x, 0.5)
            y0 = Value.of(0)
            x1 = Value.of(x)
            y0 = Value.of(1/2)
            line { color("red") }                  // цвет линии - красный
        }
        shapesList.add(shape)                      // добавление полученной фигуры в список
    }

    Plotly.page(mathJaxHeader, cdnPlotlyHeader) {
        scatter {                                  // добавление надписи "1/2"
            mode = ScatterMode.text                // будет выведен только текст
            x(-0.35)                               // положение надписи на OX
            y(0.56)                                // положение надписи на OY
            text = listOf("$\Large{1/2}$")         // увеличение шрифта средствами ТеХа
            textfont { color("red") }              // цвет шрифта - красный
            showlegend = false                     // не отображать в легенде эту запись
            hoverinfo = "none"                     // не показывать ничего при наведении курсора
        }
        ...
        layout {                                   // добавление полученного списка фигур в график
            shapes = shapesList                      
            ...
        }
    }.makeFile()
    ``` 

5. Осталось добавить на OX метки, соответствующие пересечениям синуса с осью. Это
делается аналогично с использованием меток осей (`tickvals`, `ticktext`) и записи текста в формате LaTeX.
    ```
    ...
    Plolty.page(mathJaxHeader, cdnPlotlyHeader) {
        ...
        layout {
            xaxis {                                // параметры OX
                ...
                anchor = "free"                    // положение оси задается вручную
                position = 0.43                    // заданная позиция оси
                tickvals(listOf(-2 * PI-0.05, -PI - 0.15, PI - 0.05, 2 * PI + 0.1))
                ticktext(listOf("\$\\huge{-2\\pi}\$", "\$\\huge{-\\pi}\$", "\$\\huge{\\pi}\$", "\$\\huge{2\\pi}\$"))
                // положения меток и соответствующий им текст
            }
            yaxis {                                // параметры OY
                ...
                anchor = "free"                    // положение оси задается вручную
                position = 0.485                   // заданная позиция оси
                tickvals(listOf(-0.91, 0.09, 1.09))
                ticktext(listOf("\$\\Large{-1}\$", "\$\\Large{0}\$", "\$\\Large{1}\$"))
                // положения меток и соответствующий им текст
            }
            ...
        }
    }.makeFile()
    ```

6. В качестве финального улучшения добавим легенду к графику, которая будет помещена в
правый верхний угол графика. Сначала нужно задать имя соответствующей линии, после чего
с использованием параметров `xanchor = right` и `yanchor = top`, устанавливается положение легенды так,
чтобы координаты, задаваемые параметрами `x = 1`, `y = 1`, соответствуют положению 
в правом верхнем углу изображения.
    ```
    ...
    Plotly.page(mathJaxHeader, cdnPlotlyHeader) {
        scatter {                                   // график синуса
            ...
            name = "\$\\Large{y = \\mathrm{sin}\\,x}\$"
            // отображаемое в легенде название графика
        }

        layout {
            legend {                                // параметры легенды
                x = 0.97                            // положение легенды по горизонтали
                y = 1                               // положение легенды по вертикали
                borderwidth = 1                     // ширина границы по краям легенды
                font { size = 32 }                  // размер шрифта названий графиков
                xanchor = XAnchor.right             // "привязывания" положения легенды к правому углу графика
                yanchor = YAnchor.top               // "привязывание" положения легенды к низу графика
            }
            ...
        }
    }.makeFile()
    ```

7. Готовое изображение:
![Картинка](https://i.ibb.co/wKTCp4H/newplot-17.png)
Полный код доступен по ссылке: https://mipt-npm.jetbrains.space/p/plt/code/plotly.kt/files/dev-katsam-3/examples/src/main/kotlin/tutorials/SinusPicture.kt